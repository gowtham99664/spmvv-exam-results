# Generated by Django 5.0.9 on 2026-02-24 16:23
# Patched: all DB operations are safe (IF EXISTS / IF NOT EXISTS) for idempotency

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('results', '0016_alter_examsubject_exam_date'),
    ]

    operations = [
        # HallTicket: remove ordering meta - state only, no DB change needed
        migrations.AlterModelOptions(
            name='hallticket',
            options={},
        ),
        # Remove indexes only if they exist (safe for VM which may not have them)
        migrations.RunSQL(
            sql=[
                "DROP INDEX IF EXISTS `hall_ticket_is_acti_3684f9_idx` ON `hall_ticket_exams`",
                "DROP INDEX IF EXISTS `hall_ticket_roll_nu_33ddc2_idx` ON `hall_ticket_enrollments`",
                "DROP INDEX IF EXISTS `hall_ticket_exam_id_286ec6_idx` ON `hall_ticket_enrollments`",
            ],
            reverse_sql=migrations.RunSQL.noop,
            state_operations=[
                migrations.RemoveIndex(
                    model_name='exam',
                    name='hall_ticket_is_acti_3684f9_idx',
                ),
                migrations.RemoveIndex(
                    model_name='examenrollment',
                    name='hall_ticket_roll_nu_33ddc2_idx',
                ),
                migrations.RemoveIndex(
                    model_name='examenrollment',
                    name='hall_ticket_exam_id_286ec6_idx',
                ),
            ],
        ),
        # Add subject_type to Subject if not exists
        migrations.RunSQL(
            sql="""
                ALTER TABLE `subjects`
                ADD COLUMN IF NOT EXISTS `subject_type` varchar(20) NOT NULL DEFAULT 'Theory'
            """,
            reverse_sql="ALTER TABLE `subjects` DROP COLUMN IF EXISTS `subject_type`",
            state_operations=[
                migrations.AddField(
                    model_name='subject',
                    name='subject_type',
                    field=models.CharField(choices=[('Theory', 'Theory'), ('Lab', 'Lab')], default='Theory', help_text='Subject type', max_length=20),
                ),
            ],
        ),
        # AuditLog action field - choices update, state-only (choices not enforced at DB level)
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.AlterField(
                    model_name='auditlog',
                    name='action',
                    field=models.CharField(choices=[('login', 'Login'), ('logout', 'Logout'), ('password_change', 'Password Change'), ('result_upload', 'Result Upload'), ('result_view', 'Result View'), ('result_edit', 'Result Edit'), ('result_delete', 'Result Delete'), ('result_delete_exam', 'Result Delete Exam'), ('user_registration', 'User Registration'), ('consolidated_result_view', 'Consolidated Result View'), ('circular_created', 'Circular Created'), ('circular_updated', 'Circular Updated'), ('circular_deleted', 'Circular Deleted'), ('profile_updated', 'Profile Updated')], max_length=50),
                ),
            ],
            database_operations=[],  # no DB change needed for choices
        ),
        # ExamEnrollment field alterations (help_text changes only - safe)
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.AlterField(
                    model_name='examenrollment',
                    name='roll_number',
                    field=models.CharField(db_index=True, max_length=50),
                ),
                migrations.AlterField(
                    model_name='examenrollment',
                    name='student_name',
                    field=models.CharField(max_length=200),
                ),
            ],
            database_operations=[],  # max_length unchanged, no DB change needed
        ),
        # HallTicket field alterations (help_text / blank changes - safe as state-only)
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.AlterField(
                    model_name='hallticket',
                    name='hall_ticket_number',
                    field=models.CharField(db_index=True, max_length=50, unique=True),
                ),
                migrations.AlterField(
                    model_name='hallticket',
                    name='qr_code_data',
                    field=models.CharField(default='', max_length=500),
                ),
            ],
            database_operations=[],  # unique already set, defaults don't change DB schema
        ),
    ]
